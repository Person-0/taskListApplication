var T=Object.defineProperty;var S=(t,e,a)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var d=(t,e,a)=>S(t,typeof e!="symbol"?e+"":e,a);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();class I{constructor(){d(this,"username_req","Username must be between 3 to 15 characters in length");d(this,"password_req","Password must be atleast 6 characters in length and must contain a lowercase, uppercase, numeric and special character")}username(e){return typeof e=="string"&&e.length<=15&&e.length>0}password(e){return!!(typeof e=="string"&&e.length<=100&&e.length>=6&&u("0123456789",e)&&u("`~!@#$%^&*()_+-=[]{}\\|;:'\"<,.>/?",e)&&u("ABCDEFGHIJKLMNOPQRSTUVWXYZ",e)&&u("abcdefghijklmnopqrstuvwxyz",e))}}function u(t,e){let a=!1;for(const s of e)if(t.includes(s)){a=!0;break}return a}const w=new I;class k{constructor(){d(this,"api_url","https://"+location.hostname+"/api")}_authedFetch(e){return fetch(e,{headers:{auth:localStorage.getItem("token")}})}async logout(){await this._authedFetch(this.api_url+"/logout")}async authorize(e,a,s){const n=new URLSearchParams,o=s==="signup"?"1":"0";return n.append("authType",o),w.username(e)?(n.append("username",e),w.password(a)?(n.append("password",a),(await fetch(this.api_url+"/authorize?"+n.toString())).json()):{error:!0,message:"invalid password"}):{error:!0,message:"invalid username"}}async getMyData(){return(await this._authedFetch(this.api_url+"/getMyData")).json()}async setMyTasks(e){const a=new URLSearchParams;return a.append("tasksdata",e),(await this._authedFetch(this.api_url+"/setMyTasks?"+a.toString())).json()}}const L=new k;let r={};function D(t){return`
    <div class="list-item list-item-checkbox">
        <input type="checkbox" onchange="window.taskCheckUpdate(this, ${t.sno})" class="item-checkbox" ${t.checked?"checked":""}>
    </div>
    <div class="list-item list-item-sno">${t.sno}.</div>
    <div class="list-item list-item-title">${t.title}</div>
    <div class="list-item list-item-time">${t.date}</div>
    <div class="list-item list-item-action-view" onclick="window.taskView(${t.sno})"><span class="material-symbols-outlined">visibility</span></div>
    <div class="list-item list-item-action-delete" onclick="window.taskDelete(${t.sno})"><span class="material-symbols-outlined">delete</span></div>
    `}window.taskView=function(t){y(r[t])};window.taskDelete=function(t){r[t]&&delete r[t],h().then(()=>location.reload())};window.taskCheckUpdate=function(t,e){const a=t.checked;r[e].checked=a,h()};async function h(){const t=Object.values(r),e=btoa(JSON.stringify(t)),a=await L.setMyTasks(e);a.error&&alert("Error while updating tasks: "+a.message)}function y(t=void 0){const e=window.pageElements;let a=!!t,s=t||{date:M(),sno:A()+1,title:"",checked:!1,details:""};e.taskInfoDate.innerHTML=s.date;let n=s.sno.toString();n.length<10&&(n="0"+n),e.taskInfoSno.innerHTML=n;const o=e.taskNameInput,l=e.taskCheckbox,c=e.taskDetailsInput;o.value=s.title,l.checked=s.checked,c.value=s.details,o.onchange=()=>{s.title=o.value},c.onchange=()=>{s.details=c.value},l.onchange=()=>{s.checked=l.checked},e.saveTaskBtn.onclick=async()=>{o.value.length>0&&c.value.length>0&&(r[s.sno]=s,await h(),a=!0,await window.loadApp())},e.deleteTaskBtn.onclick=()=>{a&&window.taskDelete(s.sno),window.switchTab("app")},window.switchTab("task-editor")}function E(t){const e=window.pageElements;let a;try{a=JSON.parse(atob(t.tasksdata))}catch(s){a=[],console.log("Error whle loading tasks: ",s)}if(a.length>0){e.noTasksDiv.style.display="none",e.tasksList.removeAttribute("style");for(const s of Array.from(e.tasksList.children))s.classList.contains("list-header")||s.remove();for(const s of a)e.tasksList.insertAdjacentHTML("beforeend",D(s)),r[s.sno]=s}}function A(){return Math.max(Math.max(...Object.keys(r).map(t=>parseInt(t))),0)}function M(){const t=new Date;let e=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear().toString().slice(2,4);return[e,a,s].join("/")}function p(t){window.pageElements?(window.pageElements.toastText.innerHTML=t,window.pageElements.toastDisplay.style.animation="none",window.pageElements.toastDisplay.clientWidth,window.pageElements.toastDisplay.style.animation="toast linear 3s"):(console.warn("toast: pageElements unavailable"),console.log("toast: message: "+t))}const m=new k,B={login:"#submit-login-btn",signup:"#signup-login-btn",accToggleBtn:"#acc-toggle-btn",usernameInput:"#username-input",passwordInput:"#password-input",addTaskBtn:"#add-task-btn",noTasksDiv:".no-list-items",returnToAppBtn:"#return-app-btn",saveTaskBtn:"#save-task-btn",deleteTaskBtn:"#delete-task-btn",taskNameInput:"#task-name-input",taskDetailsInput:"#task-details-textinput",tasksList:".tasks-list",taskCheckbox:".task-checkbox",taskInfoDate:".task-info-date",taskInfoSno:".task-info-sno",toastDisplay:"#toast-display",toastText:"#toast-text"},i={};for(const[t,e]of Object.entries(B)){const a=document.querySelector(e);a?i[t]=a:(i[t]=document.createElement("button"),console.error("Button ["+t+"] with selector ["+e+"] was not found."),p("pageElements were not resolved completely"))}Object.defineProperty(window,"pageElements",{value:i});Object.defineProperty(window,"switchTab",{value:g});function g(t){const e=document.querySelector("[tab-name="+t+"]");if(e){for(const a of document.querySelectorAll(".page-tab"))a.style.display="none";e.style.display="flex"}else console.error("switchTab called with invalid tabName: ",t),p("switchTab was called with invalid parameters")}async function b(){localStorage.getItem("token")&&(await m.logout(),localStorage.clear()),location.href="/"}const v=t=>async()=>{const e=i.usernameInput.value,a=i.passwordInput.value,s=await m.authorize(e,a,t);s?s.error?(console.log("authorize error: ",s.message),p("Auth error: "+s.message)):s.token&&s.tokenAge?(localStorage.setItem("token",s.token),localStorage.setItem("tokenExpiry",(Date.now()+parseInt(s.tokenAge)).toString()),await f()):alert("authorize error: auth token / token age not provided!"):p("unkown auth error")};async function f(){i.accToggleBtn.innerHTML="Logout";const t=await m.getMyData();t.error?(console.log("loadApp error: "+t.message),b()):(E(t),g("app"))}window.loadApp=f;i.login.onclick=v("login");i.signup.onclick=v("signup");i.accToggleBtn.onclick=b;i.addTaskBtn.onclick=()=>{y()};i.returnToAppBtn.onclick=()=>{g("app")};localStorage.getItem("token")?f():g("login");
